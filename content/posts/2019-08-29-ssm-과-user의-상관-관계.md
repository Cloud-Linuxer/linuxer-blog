---
title: "ssm 과 user 디렉토리 퍼미션의 상관 관계"
date: 2019-08-29T11:43:40+09:00
draft: false
categories: ["AWS", "Linux"]
tags: ["ssm", "key", "접속불가", "777"]
slug: "ssm-과-user의-상관-관계"
aliases:
  - /ssm-과-user의-상관-관계/
  - /ssm-%ea%b3%bc-user%ec%9d%98-%ec%83%81%ea%b4%80-%ea%b4%80%ea%b3%84/
---


고객사에서 ubuntu user 에 777 퍼미션을 부여해 버렸다.

chmod -R 777 /home

home 디렉토리 하단으로 모든 퍼미션이 777이 부여되었고 ubuntu계정까지 777 권한이라 KEY를 사용하여 로그인을 할수 없는 상태가 되어버렸다.

이경우에 할수있는 방법은 SSM session manager로 접속할수 있다면 간단하게 해결되었을 문제이나 신규로 생성된 인스턴스인터라 SSM을 사용하고 있지 않았다.

이경우엔 다른인스턴스에 /home 파티션만 떼서 붙여서 권한을 복구한다음에 정상화 할수 있었다.

session manager 는 권한과 상관없이 동작하는지 확인하고 싶었다.

세션 매니저로 접속

root 15229 1.0 1.5 543752 15912 ? Sl 10:30 0:00 _ /usr/bin/ssm-session-worker root-0f7a9e1a4bbc90b i-052ebb4feade551
 ssm-user 15242 0.0 0.3 124264 3280 pts/0 Ss 10:30 0:00 _ sh

쉘에서 확인시에 세션을 연결하면 위와같이 확인이된다.

유저 접속 확인

root@ip-10-0-0-12 home]# w
 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT

 root@ip-10-0-0-12 home]# last
 reboot system boot 4.14.133-113.112 Wed Aug 28 12:43 - 10:34 (21:50)

session manager 는 w나 last에서 확인할수 없다. 로그인 내역은 aws console 에서 확인해야 하고 실제로 인스턴스 내에서 확인하려면 messages 로그에서 확인해야 한다.

Aug 29 11:33:49 ip-10-0-0-12 amazon-ssm-agent: 2019-08-29 11:33:49 INFO [MessageGatewayService] [EngineProcessor] [OutOfProcExecuter] [root-0aa231b76382aca8c] channel: root-0aa231b76382aca8c not found, creatinga new file channel…

 Aug 29 11:33:49 ip-10-0-0-12 amazon-ssm-agent: 2019-08-29 11:33:49 INFO [MessageGatewayService] [EngineProcessor] [OutOfProcExecuter] [root-0aa231b76382aca8c] inter process communication started

ssm 세션 생성시에 발생하는 로그다.

이제 ssm user 에 777 부여후에 정상적으로 로그인 되는지 확인해 보겠다.

root@ip-10-0-0-12 home]# chmod 777 -R ssm-user

root@ip-10-0-0-12 home]# ls -al
 drwxrwxrwx 2 ssm-user ssm-user 83 Aug 20 22:27 ssm-user

 root@ip-10-0-0-12 ssm-user]# ls -al
 -rwxrwxrwx 1 ssm-user ssm-user 265 Aug 28 13:26 .bash_history
 -rwxrwxrwx 1 ssm-user ssm-user 18 Jul 28 2018 .bash_logout
 -rwxrwxrwx 1 ssm-user ssm-user 193 Jul 28 2018 .bash_profile
 -rwxrwxrwx 1 ssm-user ssm-user 231 Jul 28 2018 .bashrc

![](/images/2019/08/Screenshot-2019-08-29-at-11.40.01-1024x203.jpg)

정상적으로 연결되는것을 확인할 수 있었다.

key로 연결되는 계정은 권한으로 인해 접속불가 상태에 빠질수 있지만
session manager 는 인스턴스가 클라이언트가 되어 동작하는 방식이라 user 디렉토리 권한과는 상관없이 정상적으로 접근이 가능한것을 알수있다.

사실 조금 쓸데없는 테스트이긴 하나 도움이 되면 좋겠다!

아디오스!
