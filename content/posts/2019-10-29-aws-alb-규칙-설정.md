---
title: "AWS ALB 규칙 설정"
date: 2019-10-29T22:28:57+09:00
draft: false
categories: ["AWS"]
tags: ["aws alb", "alb 규칙"]
slug: "aws-alb-규칙-설정"
aliases:
  - /aws-alb-규칙-설정/
  - /aws-alb-%ea%b7%9c%ec%b9%99-%ec%84%a4%ec%a0%95/
---

\n

You have a web portal composed of two services. Each service musts scale independently. Both services should be served under the same domain. Which configuration allows this?   
 A. Use one AWS Classic Load Balancer. Create a redirect in the web server based on users' source IPs.   
 B. Use two AWS Application Load Balancer; one for each service. Assign the same CNAME to both.   
 C. Use one AWS Application Load Balancer. Specify listener rules to route requests to each service.   
 D. Use two AWS Classic Load Balancers; one for each service. Assign the same CNAME to both.

\n\n\n\n

두 개의 서비스로 구성된 웹 포털이 있습니다. 각 서비스는 독립적으로 확장해야합니다. 두 서비스 모두 동일한 도메인에서 제공되어야합니다. 어떤 구성이 가능합니까?  
 A. 하나의 AWS Classic Load Balancer를 사용하십시오. 사용자의 소스 IP를 기반으로 웹 서버에서 리디렉션을 만듭니다.  
 B. 두 개의 AWS Application Load Balancer를 사용하십시오. 각 서비스마다 하나씩. 동일한 CNAME을 둘 다에 지정하십시오.  
 C. 하나의 AWS Application Load Balancer를 사용하십시오. 요청을 각 서비스로 라우팅 할 리스너 규칙을 지정하십시오.  
 D. 두 개의 AWS Classic Load Balancer를 사용하십시오. 각 서비스마다 하나씩. 동일한 CNAME을 둘 다에 지정하십시오.

\n\n\n\n

이문제는 하나의 domain 으로 두가지의 서비스가 가능한지 물어보는 서비스이다.

\n\n\n\n

A. 출발지 IP 기반하여 서비스를 분기하는데 같은 IP에선 하나의 서비스만 사용할수 있다. 애초에 문제와 동떨어진 답이다.

\n\n\n\n

B. 두개의 ALB를 사용하고 같은 CNAME 을 사용한다. DNS 라운드로빈으로 서비스되게 된다. 정상적인 서비스는 아니다.

\n\n\n\n

C. 하나의 ALB를 사용하고 리스너 규칙을 이용하여 라우팅한다. 정답이다.

\n\n\n\n

D. 두개의 CLB, B와 같이 DNS 라운드 로빈으로 작동하여 정상적인 서비스가 아니다.

\n\n\n\n

그렇다면 여기에서 어떻게 하나의 리스너가 서비스 별로 분기가 가능한지 확인해 보자

\n\n\n\n
![](/images/2019/10/image-24.png)
\n\n\n\n
![](/images/2019/10/image-25-1024x188.png)
\n\n\n\n

리스너 규칙을 확인해 보면 현재 80->443으로 리디렉션 하고 443 리스너는 linuxer-blog-wg 로 전달한다.

\n\n\n\n

https: 443 리스너의 규칙 보기를 누르면 다음과 같다.

\n\n\n\n
![](/images/2019/10/image-26-1024x430.png)
\n\n\n\n

그냥 단일로 전달하는 구성이다. 나는 여기서 같은 도메인으로 셋팅후에 /test /test2 로 조건 분기를 하려고 한다. 설정은 다음과 같다.

\n\n\n\n
![](/images/2019/10/image-32-1024x775.png)
\n\n\n\n

host는 admin.linuxer.name 이다. 이후 리디렉션으로 각각의 다른 게시물로 연결된다.

\n\n\n\n
![](/images/2019/10/image-30.png)
\n\n\n\n
![](/images/2019/10/image-31.png)
\n\n\n\n

<https://linuxer.name/test>

\n\n\n\n

<https://linuxer.name/test2>

\n\n\n\n

두개의 경로로 접근해보면 에러페이지로 접근된다. admin 호스트가 명확하지 않기 때문이다.

\n\n\n\n

<https://admin.linuxer.name/test>

\n\n\n\n

<https://admin.linuxer.name/test2>

\n\n\n\n

두개의 페이지는 정상적으로 8월과 9월의 게시물로 정상적으로 리디렉션이된다.

\n\n\n\n

경로가 너무길거나 한글은 적용이 정상적으로 되지 않으므로 유의해야한다.

\n\n\n\n

위테스트 URL은 이해를 돕기위해 ALB 리스너 규칙에 남겨놓은 상태이므로 리디렉션이 정상적으로 되는것을 확인해 보시라.

\n\n\n\n

빼먹은 부분이 있는데 리스너 규칙을 이용한 타겟그룹으로 전달을 설정한것을 보여주지 않은것으로 보인다.

\n\n\n\n
![](/images/2019/10/image-33.png)
\n\n\n\n

위와같이 리디렉션을 전달대상으로 수정하면된다. 대상그룹으로 라우팅시에 확장이 가능한 구성을 사용할수 있다.

\n\n\n\n

이질문은 우리 동료직원들/ 한섭님 등등이 궁금해 했던 이야기 이므로

\n\n\n\n

포스팅 기회를 주신것에대해 감사를 드린다.

\n