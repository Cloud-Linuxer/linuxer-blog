---
title: "AWS ALB 규칙 설정-2"
date: 2019-11-11T20:28:48+09:00
draft: false
categories: ["AWS"]
tags: ["alb", "aws alb", "규칙"]
slug: "aws-alb-규칙-설정-2"
aliases:
  - /aws-alb-규칙-설정-2/
  - /aws-alb-%ea%b7%9c%ec%b9%99-%ec%84%a4%ec%a0%95-2/
---


![](/images/2019/11/image-4.png)

![](/images/2019/11/image-5-418x1024.png)

오픈카톡에서 받은 질문이다.

질문을 다시정리하자면

linuxer-blog-alb-1657105302.ap-northeast-2.elb.amazonaws.com <- 허용하지 않음.

이름: linuxer-blog-alb-1657105302.ap-northeast-2.elb.amazonaws.com
Addresses: 13.125.124.26
 15.164.132.46

13.125.124.26 <- 허용하지 않음
 15.164.132.46 <- 허용하지 않음
test.linuxer.name <-허용하지 않음

linuxer.name <- 허용
www.linuxer.name <-허용
리눅서.com <-허용

iptables 마냥 deny 정책 위에 allow 를 올려준다 생각하면 간단하다 그럼 여기에서 필요한건 ALB limit 인것 같다. 왜냐? 룰이 많아 질수도 있으니까.

<https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/application/load-balancer-limits.html>

![](/images/2019/11/image-6-1024x230.png)

![](/images/2019/11/image-7-1024x114.png)

여러번 공개된 리스너 규칙이다.
80->443으로 연결하고 443리스너는 linuxer-blog-wg 로 전달.. tg인데 왜 wg로 했는지는 아직도 의문이다..생성하면서 졸았나...

![](/images/2019/11/image-8-1024x660.png)

규칙을 보면 지난번에 alb 규칙 포스팅에서 셋팅한 그대로다. 그럼 이걸 수정해 줄거다.

![](/images/2019/11/image-9-1024x275.png)

route53 에선 따로 전환안해도 먹어서 그냥 입력해봤는데 안먹는다. 퓨니코드로 변환해서 넣자

![](/images/2019/11/image-10-1024x740.png)

이제 그럼 https://test.linuxer.com 으로 들어가보자. 503 error 이 그대를 맞이할것이다.

그럼 원하지 않는 문자열이나 쿼리를 503으로 띄우고 싶다면?

먼저

![](/images/2019/11/image-11.png)

내 IP를 확인했다.

![](/images/2019/11/image-13-1024x149.png)

소스 IP로 /wp-admin 을 blackhole 처리를 하고 특정 IP 하나만 열어 주었다.

<https://linuxer.name/wp-admin.php>

접속해 보시라. 503 error 가 반길것이다.

사실 요즘 admin 페이지로 유입이 있어서 wp-admin 막는거로.. 오늘 fail2ban 포스팅을 하려고 계획했는데 실패했다.

alb에서 막아버려서...

블로깅을 할수있도록 포스팅거리를 주신 이주호님께 감사를 드린다.

좋은하루 되시라!
